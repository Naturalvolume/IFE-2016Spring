# 浏览器渲染页面的过程
将浏览器渲染页面的过程分成两大步：从html到dom、从dom到页面

```html
<html>
  <head>
  </head>
  <body>
    kathy
  </body>
</html>
```

### 从html到dom
1. 字节流解码：通过http从服务端发过来的文档内容是以字节（16进制）为数据的，浏览器得到字节数据后，通过**编码嗅探算法**确定字符编码，然后根据字符编码将字节流数据进行解码，得到编写的**html文档代码**。

2. 输入流预处理：字符流数据在进入解析环节之前还需要进行一些预处理操作，比如将换行符转换成统一的格式，最终生成**规范化的字符流数据**。

3. 令牌化：使用**类似状态机**的算法，即每次接收一个或多个输入流中的字符；然后根据当前状态和这些字符来更新下一个状态，也就是说在不同的状态下接收同样的字符数据可能会产生不同的结果，如`body`字符串，在标签打开状态会解析成标签，在标签关闭状态则会解析成文本节点。

最终解析成这样的令牌结构：
```
开始标签:html
  开始标签:head
  结束标签:head
  开始标签:body
    字符串:kathy
  结束标签:body
结束标签:html
```

##### 注意：遇到script标签时暂停解析过程
若是内联代码，那么解析过程会暂停，执行权限转给js脚本引擎，待js脚本执行完成后再由渲染引擎继续解析。

有一种情况例外，当脚本内容中调用了改变dom 结构的`document.write()`函数，此时渲染引擎会回到第二步，将这些代码加入字符流，重新进行解析。

外链脚本则根据标签属性执行对应操作。

4. 构建dom树：标记步骤产生的令牌会被送到**树构建器**进行处理，html5标准中定义了每类令牌对应的dom元素，当树构建器收到某个令牌时就会创建该令牌对应的dom元素并将该元素插入到dom树中。

5. 从css到CSSOM：css解析过程与html解析过程步骤一致，最终也会生成树状结构，知识CSSOM树的节点具有继承特性，也就是会先继承父节点样式作为当前样式，然后再进行补充或覆盖（包括浏览器提供的默认样式）。

### 从dom到渲染

