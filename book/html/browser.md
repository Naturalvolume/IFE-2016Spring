# 浏览器
### chrome 打开一个页面需要启动多少线程？
chrome 是第一个采取多进程架构的浏览器
- 浏览器进程：负责界面显示、用户交互、子进程管理，同时提供存储等功能；
- 渲染进程：将html、css、js转换为**用户可以交互的网页**，**排版引擎**和**js v8引擎**都在渲染进程中，每个**tab标签**都会创建一个渲染进程，处于安全考虑，渲染进程都运行在**沙箱模式**下；
- gpu进程：实现3D css效果，UI 界面也采用GPU绘制；
- 网络进程：负责页面的网络资源加载；
- 多个插件进程

**主动防御**：发现程序有可疑行为时立即拦截并终止运行
**沙盒技术原理**：发现可疑行为后让程序继续运行，只有发现的确是病毒时才会终止
**沙盒技术运行流程**：让疑似病毒文件的可疑行为在虚拟的沙盒中表演，沙盒会记下它的每一个动作，当疑似病毒充分暴露了病毒属性后，沙盒就会执行**回滚**机制，将病毒的痕迹和动作抹去，恢复系统到正常状态
[浏览器沙盒模型](https://www.cnblogs.com/slly/p/6639173.html)

### 浏览器渲染过程
- 构建dom树：从**网络**或**硬盘**中获得html，将字节解析为文件指定编码字符，根据html规范将字符串转换成各种令牌标签（如html、body等），解析成一个树状对象模型（dom树）
- 样式计算：style标签内的css、内嵌的css、外链css
- 创建布局树：遍历dom树，将所有可见节点加入布局树，计算dom元素的布局信息
- 分层：渲染引擎为特定的节点（如3D变换、页面滚动、设置z-index的定位元素）生成专用的图层，并生成一棵对应的图层树
- 拆分绘制图层：把一个图层的绘制拆分成很多小的绘制指令，把指令按顺序组成一个待绘制列表，列表准备好之后，主线程将绘制列表提交给**合成线程**，合成线程**将图层划分为图块**
- 栅格化：按照视口附近的图块优先生成位图
- 显示：所有图块被栅格化后，合成线程生成绘制图块的命令，将该命令提交给浏览器进程，浏览器最后进行显示

### 会引起回流和重绘的操作
**回流**：
- 常见的几何属性改变：width、height、padding、margin、left、top、border等
- 获取一些需要立刻计算得到的属性：offsetTop、offsetLeft、offsetWidth、offsetHeight、scrollTop、scrollLeft、scrollWidth、scrollHeight、clientTop、clientLeft、clientWidth、clientHeight时，浏览器为了获取这些值，也会进行回流
- 调用 getComputedStyle 方法，或IE里的 currentStyle 时，也会触发回流（即时性、准确性）
**避免方式**：
- 使用类名合并改变样式
- 提升为合成层，如使用will-change
  - 合成层的位图会交给gpu合成，比cpu处理要快
  - 只会repaint本身，不会影响到其它层
  - 对 transform 和 opacity，不会触发 layout 和 paint

浏览器使用**flush队列**，缓存触发的回流和重绘任务，待队列中任务多起来 或者 到了一定的时间间隔 或 不得已的时候将任务一口气出队，所以，当访问即时属性时，浏览器会为了获得此时此刻、最准确的属性值，将flush队列的任务出队。


